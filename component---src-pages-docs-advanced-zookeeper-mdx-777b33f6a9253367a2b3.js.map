{"version":3,"sources":["webpack:///./src/pages/docs/advanced-zookeeper.mdx","webpack:///./src/layouts/docs.tsx"],"names":["pageTitle","_frontmatter","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","props","mdxType","parentName","isMDXComponent","DocsLayout","candidateMdxNodes","allMdx","nodes","index","docsIndex","prefix","pageTitleSuffix"],"mappings":"6oPAMO,IAAMA,EAAY,mCACZC,EAAe,GAOtBC,EAAc,CAClBF,YACAC,gBAEIE,EAAYC,IACH,SAASC,EAAT,GAGZ,IAFDC,EAEC,EAFDA,WACGC,E,oIACF,mBACD,OAAO,YAACJ,EAAD,iBAAeD,EAAiBK,EAAhC,CAAuCD,WAAYA,EAAYE,QAAQ,cAI5E,iBAAQ,CACN,GAAM,mCACN,MAAS,CACP,SAAY,aAEb,+BAAGC,WAAW,MAAS,CACtB,KAAQ,oCACR,aAAc,6CACd,UAAa,kBACZ,iCAAKA,WAAW,KAAQ,CACvB,cAAe,OACf,UAAa,QACb,OAAU,KACV,QAAW,MACX,QAAW,YACX,MAAS,OACR,kCAAMA,WAAW,OAAU,CAC1B,SAAY,UACZ,EAAK,qVAlBb,oCAoBA,iBAAQ,CACN,UAAa,gBACb,KAAQ,cAFV,qBAIA,sBACE,kBAAIA,WAAW,MAAK,+BAAGA,WAAW,MAAS,CACvC,KAAQ,oCADQ,oCAItB,0DAAyC,+BAAGA,WAAW,KAAQ,CAC3D,KAAQ,uIAD6B,yBAAzC,qBAGF,+BAAGA,WAAW,KAAQ,CAChB,KAAQ,kCADd,oBAHE,gDAMA,uBAAK,kCAAMA,WAAW,OAAU,CAC5B,UAAa,kBADZ,sMAOL,+CAA8B,0BAAYA,WAAW,KAAvB,gBAA9B,yDAAgJ,0BAAYA,WAAW,KAAvB,QAAhJ,kCACsB,0BAAYA,WAAW,KAAvB,OADtB,sEAEA,iCAAgB,+BAAGA,WAAW,KAAQ,CAClC,KAAQ,uKADI,iCAAhB,kCAGA,uBAAK,kCAAMA,WAAW,OAAU,CAC5B,UAAa,kBADZ,ydAWL,qEACA,uBAAK,kCAAMA,WAAW,OAAU,CAC5B,UAAa,kBADZ,6JAML,4FACF,+BAAGA,WAAW,KAAQ,CAChB,KAAQ,kIADd,yCADE,aAIA,iBAAQ,CACN,GAAM,iCACN,MAAS,CACP,SAAY,aAEb,+BAAGA,WAAW,MAAS,CACtB,KAAQ,kCACR,aAAc,2CACd,UAAa,kBACZ,iCAAKA,WAAW,KAAQ,CACvB,cAAe,OACf,UAAa,QACb,OAAU,KACV,QAAW,MACX,QAAW,YACX,MAAS,OACR,kCAAMA,WAAW,OAAU,CAC1B,SAAY,UACZ,EAAK,qVAlBb,kCAoBA,4BAAW,+BAAGA,WAAW,KAAQ,CAC7B,KAAQ,2LADD,2CAAX,oDAGA,uBAAK,kCAAMA,WAAW,OAAU,CAC5B,UAAa,kBADZ,waAaL,sDACF,+BAAGA,WAAW,KAAQ,CAChB,KAAQ,0FADd,oBADE,sDAKA,uBAAK,kCAAMA,WAAW,OAAU,CAC5B,UAAa,kBADZ,yfAeL,oDAAmC,+BAAGA,WAAW,KAAQ,CACrD,KAAQ,6KADuB,oCAAnC,qIAIF,+BAAGA,WAAW,KAAQ,CAChB,KAAQ,0FADd,qBAJE,gPASI,+BAAGA,WAAW,KAAQ,CACtB,KAAQ,uKADR,iCATJ,gJAaA,4FACF,+BAAGA,WAAW,KAAQ,CAChB,KAAQ,kIADd,yCADE,cAQJJ,EAAWK,gBAAiB,G,yGCnIbC,IA9B+B,SAAAJ,GAAS,IAElCK,EAFkC,OAEnDC,OAAUC,MAiBZ,OACE,kBAAC,IAAD,iBACMP,EADN,CAEEK,kBAAmBA,EACnBG,MAAOC,EACPC,OAAO,OACPC,gBAAgB","file":"component---src-pages-docs-advanced-zookeeper-mdx-777b33f6a9253367a2b3.js","sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsx mdx */\n\nimport DefaultLayout from \"/home/trustin/Workspaces/upstream-armeria/site/src/layouts/docs.tsx\";\nexport const pageTitle = \"Service discovery with ZooKeeper\";\nexport const _frontmatter = {};\n\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n  return <div {...props} />;\n};\n\nconst layoutProps = {\n  pageTitle,\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n\n    <h1 {...{\n      \"id\": \"service-discovery-with-zookeeper\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h1\" {...{\n        \"href\": \"#service-discovery-with-zookeeper\",\n        \"aria-label\": \"service discovery with zookeeper permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a>{`Service discovery with ZooKeeper`}</h1>\n    <h6 {...{\n      \"className\": \"inlinePageToc\",\n      \"role\": \"navigation\"\n    }}>{`Table of contents`}</h6>\n    <ul>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"#automatic-service-registration\"\n        }}>{`Automatic service registration`}</a></li>\n    </ul>\n    <p>{`You can put the list of available `}<a parentName=\"p\" {...{\n        \"href\": \"typeplural://Endpoint:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/Endpoint.html\"\n      }}>{`typeplural://Endpoint`}</a>{` into a zNode in\n`}<a parentName=\"p\" {...{\n        \"href\": \"https://zookeeper.apache.org/\"\n      }}>{`Apache ZooKeeper`}</a>{` cluster as a node tree, like the following:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\"\n      }}>{`# Note: Only child node values are used. i.e. Child node names are ignored.\n- /myProductionEndpoints\n  - /192.168.1.10_8080: 192.168.1.10:8080\n  - /192.168.1.11_8080: 192.168.1.11:8080:100\n`}</code></pre>\n    <p>{`In the examples above, `}<inlineCode parentName=\"p\">{`192.168.1.10`}</inlineCode>{` and other IP strings are your servers' IP addresses, `}<inlineCode parentName=\"p\">{`8080`}</inlineCode>{` is a\nservice port number and `}<inlineCode parentName=\"p\">{`100`}</inlineCode>{` is a weight value. You can omit a weight value as it is optional.`}</p>\n    <p>{`Create a `}<a parentName=\"p\" {...{\n        \"href\": \"type://ZooKeeperEndpointGroup:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/zookeeper/ZooKeeperEndpointGroup.html\"\n      }}>{`type://ZooKeeperEndpointGroup`}</a>{` to retrieve this information:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-java\"\n      }}>{`import com.linecorp.armeria.client.endpoint.EndpointGroup;\nimport com.linecorp.armeria.client.zookeeper.ZooKeeperEndpointGroup;\n\nEndpointGroup myEndpointGroup =\n        ZooKeeperEndpointGroup.builder(/* zkConnectionStr */ \"myZooKeeperHost:2181\",\n                                       /* zNodePath       */ \"/myProductionEndpoints\")\n                              .customizer(builder ->  builder.sessionTimeoutMs(10000))\n                              .build();\n`}</code></pre>\n    <p>{`And then specify it when you build a client:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-java\"\n      }}>{`HelloService.Iface helloClient =\n        Clients.builder(\"tbinary+http\", myEndpointGroup, \"/hello\")\n               .build(HelloService.Iface.class);\n`}</code></pre>\n    <p>{`For more information, please refer to the API documentation of the\n`}<a parentName=\"p\" {...{\n        \"href\": \"https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/zookeeper/package-summary.html\"\n      }}>{`com.linecorp.armeria.server.zookeeper`}</a>{` package.`}</p>\n    <h2 {...{\n      \"id\": \"automatic-service-registration\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h2\" {...{\n        \"href\": \"#automatic-service-registration\",\n        \"aria-label\": \"automatic service registration permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a>{`Automatic service registration`}</h2>\n    <p>{`Use `}<a parentName=\"p\" {...{\n        \"href\": \"type://ZooKeeperUpdatingListenerBuilder:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/zookeeper/ZooKeeperUpdatingListenerBuilder.html\"\n      }}>{`type://ZooKeeperUpdatingListenerBuilder`}</a>{` to register your server to a ZooKeeper cluster:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-java\"\n      }}>{`import com.linecorp.armeria.server.ServerListener;\nimport com.linecorp.armeria.server.zookeeper.ZooKeeperUpdatingListenerBuilder;\n\nZooKeeperUpdatingListener listener =\n        ZooKeeperUpdatingListener.builder(\"myZooKeeperHost:2181\", \"/myProductionEndpoints\")\n                                 .sessionTimeout(10000)\n                                 .build();\nserver.addListener(listener);\nserver.start();\n...\n`}</code></pre>\n    <p>{`You can also use an existing\n`}<a parentName=\"p\" {...{\n        \"href\": \"https://curator.apache.org/apidocs/org/apache/curator/framework/CuratorFramework.html\"\n      }}>{`CuratorFramework`}</a>{`\ninstance instead of ZooKeeper connection string:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-java\"\n      }}>{`import com.linecorp.armeria.server.ServerListener;\nimport com.linecorp.armeria.server.zookeeper.ZooKeeperUpdatingListenerBuilder;\nimport org.apache.curator.framework.CuratorFramework;\n\nCuratorFramework client = ...\nZooKeeperUpdatingListener listener =\n        ZooKeeperUpdatingListener.builder(client, \"/myProductionEndpoints\")\n                                 .code(NodeValueCodec.ofDefault())\n                                 .build();\nserver.addListener(listener);\nserver.start();\n...\n`}</code></pre>\n    <p>{`When your server starts up, `}<a parentName=\"p\" {...{\n        \"href\": \"type://ZooKeeperUpdatingListener:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/server/zookeeper/ZooKeeperUpdatingListener.html\"\n      }}>{`type://ZooKeeperUpdatingListener`}</a>{` will register the server automatically to the\nspecified zNode as a member of the cluster. Each server will represent itself as\n`}<a parentName=\"p\" {...{\n        \"href\": \"https://zookeeper.apache.org/doc/r3.4.10/zookeeperOver.html#Nodes+and+ephemeral+nodes\"\n      }}>{`an EPHEMERAL node`}</a>{`, which\nmeans when a server stops or a network partition between your server and ZooKeeper cluster occurs, the node of\nthe server that became unreachable will be deleted automatically by ZooKeeper. As a result, the clients that\nuse a `}<a parentName=\"p\" {...{\n        \"href\": \"type://ZooKeeperEndpointGroup:https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/client/zookeeper/ZooKeeperEndpointGroup.html\"\n      }}>{`type://ZooKeeperEndpointGroup`}</a>{` will be notified and they will update their endpoint list automatically\nso that they do not attempt to connect to the unreachable servers.`}</p>\n    <p>{`For more information, please refer to the API documentation of the\n`}<a parentName=\"p\" {...{\n        \"href\": \"https://javadoc.io/doc/com.linecorp.armeria/armeria-javadoc/latest/com/linecorp/armeria/common/zookeeper/package-summary.html\"\n      }}>{`com.linecorp.armeria.server.zookeeper`}</a>{` package.`}</p>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      ","import { RouteComponentProps } from '@reach/router';\nimport { graphql, useStaticQuery } from 'gatsby';\nimport React from 'react';\n\nimport docsIndex from '../pages/docs/toc.json';\nimport MdxLayout from './mdx';\n\ninterface DocsLayoutProps extends RouteComponentProps {\n  pageContext: any;\n  pageTitle: string;\n}\n\nconst DocsLayout: React.FC<DocsLayoutProps> = props => {\n  const {\n    allMdx: { nodes: candidateMdxNodes },\n  } = useStaticQuery(graphql`\n    query {\n      allMdx(filter: { fileAbsolutePath: { glob: \"**/src/pages/docs/**\" } }) {\n        nodes {\n          tableOfContents(maxDepth: 1)\n          parent {\n            ... on File {\n              sourceInstanceName\n              name\n            }\n          }\n        }\n      }\n    }\n  `);\n\n  return (\n    <MdxLayout\n      {...props}\n      candidateMdxNodes={candidateMdxNodes}\n      index={docsIndex}\n      prefix=\"docs\"\n      pageTitleSuffix=\"Armeria documentation\"\n    />\n  );\n};\n\nexport default DocsLayout;\n"],"sourceRoot":""}